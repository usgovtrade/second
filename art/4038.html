<!DOCTYPE html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><script async src='https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8422244967817077' crossorigin=anonymous'></script><link rel='stylesheet' href='/class.css'><script src='/script.js'></script></head><body><div class='topnav'></div><div class='list'></div><div class='stats'><div class='logodiv'><a href='/'><img class='logoimg' src='/img/elephant.svg' /></a></div> </div><div class='nav'><a href='4037.html'> << </a>&nbsp;&nbsp;&nbsp;&nbsp;<a href='4039.html'> >> </a></div><div class='article'>Q:

What is the right way to do an asynchronous call to fetch a JSON payload using Retrofit 2.0?

I was trying to learn how to use Retrofit for an Android app, but the example they gave at the official site in the following link: https://futurestud.io/tutorials/retrofit-tutorial-part-3-asynchronous-networking does not make sense.
For example, if I'm retrieving some JSON data from a server using retrofit, it should look like this:
    @GET("/data.json")
    Call<Data> dataResponse()

And then, I should implement the callback like this:
    dataResponse().enqueue(new Callback<Data>() {
        @Override
        public void onResponse(Call<Data> call, Response<Data> response) {
            if (response.isSuccessful()) {
                Data data = response.body();
            }
        }

        @Override
        public void onFailure(Call<Data> call, Throwable t) {
        }
    });

When you send the request using http://192.168.1.2/getdata.php it will create a request with the following body:
{
    "data": {
        "name": "data",
        "state": "123",
        "data": [{
            "name": "data",
            "state": "123",
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            }
        }, {
            "name": "data",
            "state": "123",
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            }
        }]
    }
}

I thought that it could be done as follows:
    interface ListModel {
    String name;
    String state;
    List<Data> data;
    }
    interface Data {
    String name;
    String state;
    List<Data> data;
    }

    class DataService {
    private static final String BASE_URL = "http://192.168.1.2";

    private List<ListModel> get(String... params) {
    List<ListModel> list = new ArrayList<>();
    for(String param : params) {
    String uri = String.format("get?%s=%s", param, param);
    Call<ListModel> call = HttpClient.getHttp().getCall(uri);
    try {
        list = call.execute().body();
    } catch (IOException e) {
        e.printStackTrace();
    }
    }
    return list;
    }

    class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    // Get JSON from API and parse it using GSON
    Call<List<ListModel>> call = new RetrofitInstance(DataService.class)
                    .get(new String[]{"data", "id", "2"}, new String[]{"name", "state", "data"});
    call.enqueue(new Callback<List<ListModel>>() {
        @Override
        public void onResponse(Call<List<ListModel>> call, Response<List<ListModel>> response) {
            if (response.isSuccessful()) {
                List<ListModel> models = response.body();
                // Do something with models
            } else {
                // handle error
                String error = response.errorBody().string();
            }
        }

        @Override
        public void onFailure(Call<List<ListModel>> call, Throwable t) {

        }
    });
    }
    }

    class RetrofitInstance {
    public static Retrofit getRetrofitInstance() {
        return Retrofit.Builder()
                    .baseUrl(BASE_URL)
                    .addConverterFactory(GsonConverterFactory.create())
                    .build();
    }
    }

And I was going to parse the JSON in the RetrofitInstance class like this:
        JSONObject jsonObject = new JSONObject(jsonString);
        Gson gson = new Gson();
        DataModel dataModel = gson.fromJson(jsonObject.toString(), DataModel.class);
        List<Data> dataList = dataModel.getData();

But, in this case, the JSON is not properly parsed. The JSON that is sent from the server is different from what I'm expecting. It looks like this:
{
    "data": {
        "name": "data",
        "state": "123",
        "data": [{
            "name": "data",
            "state": "123",
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            }
        }],
        "data": {
            "name": "data",
            "state": "123",
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            }
        },
        "data": {
            "name": "data",
            "state": "123",
            "data": {
                "name": "data",
                "state": "123"
            },
            "data": {
                "name": "data",
                "state": "123"
            },
            </div></body></html><!-- 2022-06-25 09:34:27 